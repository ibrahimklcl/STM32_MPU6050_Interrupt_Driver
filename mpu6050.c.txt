#include "mpu6050.h"

HAL_StatusTypeDef MPU6050_Init(I2C_HandleTypeDef *hi2c)
{
    uint8_t check;
    uint8_t data;

    // MPU6050'nin kimliğini kontrol et
    HAL_I2C_Mem_Read(hi2c, MPU6050_ADDRESS , MPU6050_WHO_AM_I, I2C_MEMADD_SIZE_8BIT, &check, I2C_MEMADD_SIZE_8BIT, 1000);

    if (check == 0x68)
    {
        // Güç yönetimi ve jiroskop konfigürasyon ayarlarını yap
        data = 0x00;  // Çalışma moduna getirme
        HAL_I2C_Mem_Write(hi2c, MPU6050_ADDRESS , MPU6050_PWR_MGMT_1, I2C_MEMADD_SIZE_8BIT, &data, I2C_MEMADD_SIZE_8BIT, 1000);

        data = 0x00;  // Jiroskop ayarlarını yap
        HAL_I2C_Mem_Write(hi2c, MPU6050_ADDRESS , MPU6050_GYRO_CONFIG, I2C_MEMADD_SIZE_8BIT, &data, I2C_MEMADD_SIZE_8BIT, 1000);

        return HAL_OK;
    }

    return HAL_ERROR;
}

HAL_StatusTypeDef MPU6050_ReadGyro(I2C_HandleTypeDef *hi2c, int16_t *gyroData)
{
    uint8_t rawData[6];
    HAL_StatusTypeDef status;

    // Jiroskop verilerini oku
    status = HAL_I2C_Mem_Read(hi2c, MPU6050_ADDRESS, MPU6050_GYRO_XOUT_H, I2C_MEMADD_SIZE_8BIT, rawData, 6, 1000);

    if (status != HAL_OK)
    {
        return status;
    }

    // Okunan verileri dönüştür
    gyroData[0] = ((int16_t)rawData[0] << 8) | rawData[1];  // X-axis
    gyroData[1] = ((int16_t)rawData[2] << 8) | rawData[3];  // Y-axis
    gyroData[2] = ((int16_t)rawData[4] << 8) | rawData[5];  // Z-axis

      gyroData[0] = gyroData[0] / 1684;
      gyroData[1] = gyroData[1] / 1684;
      gyroData[2] = gyroData[2] / 1684;


    return HAL_OK;
}